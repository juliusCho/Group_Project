<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib prefix="c"  uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>
<fmt:setLocale value="${sessionScope.country}"/>
<!DOCTYPE html>
<html>
<fmt:bundle basename="${sessionScope.basename}">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=EUC-KR">
<script type="text/javascript" src="<c:url value="/resources/js/jquery-3.1.1.js" />"></script>
<link rel="stylesheet" type="text/css" href="<c:url value="/resources/css/sub_main.css" />" />
<link rel="stylesheet" type="text/css" href="<c:url value="/resources/css/insertImg.css" />" />
<link rel="stylesheet" href="<c:url value="/resources/jquery_ui/flick/jquery-ui.css" />" />
<script type="text/javascript" src="<c:url value="/resources/jquery_ui/jquery-ui.js" />"></script>
<script>
	var displaying = '';
	var windowOff = false;
	var changedImg = '';

	window.onload = function() {
		uploadDisplay();
	}
	
	function uploadDisplay() {
		displaying += '<div id="file_up" align="left"><input type="file" name="art_pic" id="art_pic" size=40 accept="image/*"/></div>';
		displaying += '<div id="file_up" align="left"><input type="button" style="width:73px;" value="<fmt:message key="upload.upload"/>" id="btnInsert" /></div>';
	}
    
	$(function() {
		$('#uploadImg').html(displaying);
		$('#btnInsert').click(function() {		
			
			var file = $('#art_pic')[0].files[0];
            var formData = new FormData();
            formData.append('upFile', file);
			
		    $.ajax({
		    	method:'POST',
		    	url:'./insertImg',
                processData: false,
                contentType: false,
                data:formData
		    }).done(function(display) {
		    	var show = '';
		    	if(display.imageName == 'fail') {
		    		show += '<fmt:message key="upload.nofileMsg"/>';
			    	show += '<br/><input type="file" name="art_pic" id="art_pic" size=40 accept="image/*"/>';
			    	show += '<input type="button" value="<fmt:message key="upload.upload"/>" id="btnInsert"/>';
		    	} else if(display.imageName == 'exceeded') {
		    		show += '<fmt:message key="upload.exceededMsg1"/>10MB<fmt:message key="upload.exceededMsg2"/>';
			    	show += '<br/><input type="file" name="art_pic" id="art_pic" size=40 accept="image/*"/>';
			    	show += '<input type="button" value="<fmt:message key="upload.upload"/>" id="btnInsert"/>';
		    	} else if(display.imageName == 'notImg') {
		    		show += '<fmt:message key="upload.notImgMsg"/>';
			    	show += '<br/><input type="file" name="art_pic" id="art_pic" size=40 accept="image/*"/>';
			    	show += '<input class="ui-button ui-widget ui-corner-all" type="button" value="<fmt:message key="upload.upload"/>" id="btnInsert"/>';
		    	} else {
		    		show += '<input type="button" value="<fmt:message key="upload.confirm"/>" onclick="javascript:clickOk();"/>';
		    		show += '<br/><img src="<c:url value="/member/' + display.url + '"/>" alt="<fmt:message key="upload.noImgMsg"/>"/>';
		    		changedImg = display.url;
		    	}
	    		$('#uploadImg').html(show);
		    });
		});
	});
	
	function clickOk() {
		$(function() {
			$('#pic_input', opener.document).html('<img src="<c:url value="/member/' + changedImg + '"/>"/>' +
										'<input type="hidden" id="art_pic" value="' + changedImg + '"/>');
			self.close();
		});
	}
</script>
</head>
<body style="margin:0 auto;">
<form method="post" enctype="text" enctype="multipart/form-data">
<table align="center" style="width:100%">
	<tr>
		<td align="center" colspan="2" height="70"><h3><fmt:message key="upload.title"/></h3></td>
	</tr>
	<tr align="center">
		<th style="width:150px; height:50px; background-color:#dcdcdc" align="center" ><fmt:message key="upload.fileformat"/></th>
		<td id="warningMsg"  style="width:350px; height:50px; background-color:#ededed" align="left">
			** jpg, bmp, gif, png <fmt:message key="upload.compatMsg1"/><br/><fmt:message key="upload.compatMsg2"/> **
		</td>
	</tr>
	<tr align="center">
		<th style="width:150px; height:50px; background-color:#dcdcdc" align="center"><fmt:message key="upload.fileSize"/></th>
		<td id="warningMsg2" style="width:350px; height:50px; background-color:#ededed" align="left">
			** <fmt:message key="upload.artMsg1"/><br/>
			** <fmt:message key="upload.artMsg2"/>
		</td>
	</tr>
	<tr align="center">
		<td colspan="2">
			<div id="uploadImg"></div>
		</td>
	</tr>
</table>
</form>
</body>
</fmt:bundle>
</html>